<!DOCTYPE html>
<html lang="en">

	<head>
		<!-- Required meta tags -->
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
		<title>用户中心</title>
		<link rel="stylesheet" type="text/css" href="../css/bootstrap.css" />
		<link rel="stylesheet" href="../node_modules/mdi/css/materialdesignicons.min.css">
		<link rel="stylesheet" href="css/style.css">
		<link rel="shortcut icon" href="images/favicon.png" />
		<script src="../js/jquery.js" type="text/javascript" charset="utf-8"></script>
		<style type="text/css">
			.mdc-persistent-drawer .mdc-drawer-item a:hover {
				color: #d00;
			}
			
			.mnrightbk {
				margin-left: 30px;
			}
			
			.mnrightbk h3 {
				font-weight: normal;
				font-size: 18px;
				position: relative;
				margin-bottom: 16px;
				color: #111;
				background: #f2f4f7;
				padding-left: 10px;
				height: 40px;
				width: 1000px;
				line-height: 40px;
			}
			
			.mimadiv {
				background: #f2f4f7;
				padding: 20px 0;
				height: 600px;
			}
			
			.mimadiv tbody {
				display: table-row-group;
				vertical-align: middle;
				border-color: inherit;
			}
			
			.onShow {
				background: url(images/onShow.png) no-repeat 0 2px;
				padding-left: 25px;
				margin-left: 10px;
				font-size: 12px;
				line-height: 22px;
				vertical-align: middle;
			}
			.onCorrect {
    background: url(images/onCorrect.gif) no-repeat 0 2px;
    padding-left: 25px;
    margin-left: 10px;
    font-size: 12px;
    line-height: 22px;
    vertical-align: middle;
}
.onError {
    background:  url(images/onError.gif) no-repeat 0 2px;
    padding-left: 25px;
    font-size: 12px;
    line-height: 22px;
    vertical-align: middle;
}
			
			.mimadiv tr {
				display: table-row;
				vertical-align: inherit;
				border-color: inherit;
				height: 50px;
			}
			
			.mimadiv td {
				font-size: 14px;
				padding: 6px;
			}
			
			.mimadiv td font {
				color: #d00;
			}
			
			.mimabtn {
				background: #f55e2f;
				color: #fff;
				width: 200px;
				height: 44px;
				border: 0;
				border-radius: 2px;
				font-size: 18px;
				font-family: "Microsoft Yahei";
				margin-top: 10px;
			}
			
			.mdc-persistent-drawer .mdc-drawer-item .mdc-drawer-link i.mdc-drawer-item-icon {
				font-size: 1.5rem;
				margin-top: 5px;
			}
			.yanzheng span {
    float: left;
    font-size: 12px;
    line-height: 28px;
}
.yanzheng input{
	width: 115px;
    float: left;
    font-size: 16px;
    height: 24px;
    line-height: 24px;
    padding: 0;
    background: #fff;
    margin-right: 30px;
}
.yanzheng #canvas {
    vertical-align: middle;
    box-sizing: border-box;
    border: 1px solid #ddd;
    cursor: pointer;
}
		</style>
	</head>

	<body>
		<div class="body-wrapper">
			<aside class="mdc-persistent-drawer mdc-persistent-drawer--open">
				<nav class="mdc-persistent-drawer__drawer">
					<div class="mdc-persistent-drawer__toolbar-spacer">
						<a href="../html/index.html" class="brand-logo">
							<img src="images/logo.png" alt="logo">
						</a>
					</div>
					<div class="mdc-list-group">
						<nav class="mdc-list mdc-drawer-menu">
							<div class="mdc-list-item mdc-drawer-item">
								<a href="houtai.html" class="mdc-drawer-link" style="background: #cff;">
                <i class="material-icons mdc-list-item__start-detail mdc-drawer-item-icon" aria-hidden="true">track_changes</i>
                我的主页
              </a>
							</div>
							<div class="mdc-list-item mdc-drawer-item" href="#" data-toggle="expansionPanel" target-panel="ui-sub-menu">
								<a class="mdc-drawer-link" href="#" id="myziliao">
									<i class="material-icons mdc-list-item__start-detail mdc-drawer-item-icon" aria-hidden="true">dashboard</i> 我的资料管理
									<i class="mdc-drawer-arrow material-icons">arrow_drop_down</i>
								</a>
								<div class="mdc-expansion-panel" id="ui-sub-menu" style="display: block;height: 150px;">
									<nav class="mdc-list mdc-drawer-submenu">
										<div class="mdc-list-item mdc-drawer-item">
											<a class="mdc-drawer-link" href="gaimima.html">
												密码修改
											</a>
										</div>
										<div class="mdc-list-item mdc-drawer-item">
											<a class="mdc-drawer-link" href="ziliao.html" style="color: #f00;">
												个人资料
											</a>
										</div>
										<div class="mdc-list-item mdc-drawer-item">
											<a class="mdc-drawer-link" href="zhuxiao.html">
												账号注销
											</a>
										</div>
									</nav>
								</div>
							</div>

							<div class="mdc-list-item mdc-drawer-item" href="#" data-toggle="expansionPanel" target-panel="sample-page-submenu">
								<a class="mdc-drawer-link" href="#" id="fabuxinxi">
									<i class="material-icons mdc-list-item__start-detail mdc-drawer-item-icon" aria-hidden="true">pages</i> 发布信息
									<i class="mdc-drawer-arrow material-icons">arrow_drop_down</i>
								</a>
								<div class="mdc-expansion-panel" id="sample-page-submenu">
									<nav class="mdc-list mdc-drawer-submenu">
										<div class="mdc-list-item mdc-drawer-item">
											<a class="mdc-drawer-link" href="#">
												招商代理供应
											</a>
											<a class="mdc-drawer-link" href="#">
												发布
											</a>
										</div>
										<div class="mdc-list-item mdc-drawer-item">
											<a class="mdc-drawer-link" href="#">
												展会信息
											</a>
										</div>
										<div class="mdc-list-item mdc-drawer-item">
											<a class="mdc-drawer-link" href="#">
												发布
											</a>
										</div>
									</nav>
								</div>
							</div>
							<div class="mdc-list-item mdc-drawer-item">
								<a class="mdc-drawer-link" href="#">
									<i class="material-icons mdc-list-item__start-detail mdc-drawer-item-icon" aria-hidden="true">grid_on</i> 企业建站
								</a>
							</div>
							<div class="mdc-list-item mdc-drawer-item">
								<a class="mdc-drawer-link" href="#">
									<i class="material-icons mdc-list-item__start-detail mdc-drawer-item-icon" aria-hidden="true">pie_chart_outlined</i> 意见箱
								</a>
							</div>
							<div class="mdc-list-item mdc-drawer-item purchase-link">
								<a href="../html/index.html" target="_blank" class="mdc-button mdc-button--raised mdc-button--dense mdc-drawer-link" data-mdc-auto-init="MDCRipple">
									返回美酒招商首页
								</a>
							</div>
						</nav>
					</div>
				</nav>
			</aside>
			<div class="neirong" style="margin-left: 270px;">
				<h1>MAIN</h1>
				<div class="mnrightbk">
					<h3>
                <img src="images/mnico38.png" style="margin-right: 10px;">个人资料管理</h3>
					<div class="mimadiv">
						<table width="80%" border="0" align="center" cellpadding="0" cellspacing="0">
							<tbody>
								<tr>
									<td width="20%" align="right">
										用户名：
									</td>
									<td id="username">
										
									</td>
									<td>
										&nbsp;
									</td>
								</tr>
								<tr>
									<td align="right">
										姓名：
									</td>
									<td>
										<input name="tbChenHu" type="text" id="tbChenHu" class="inputk">
									</td>
									<td>
										&nbsp;
									</td>
								</tr>
								<tr>
									<td align="right">
										<font>*</font>昵称：
									</td>
									<td>
										<input name="tbNickName" type="text" id="tbNickName" class="inputk">
									</td>
									<td>
										<div style="width: 350px; margin: 0px; padding: 0px; background: transparent;" id="tbNickNameTip" class="onShow">
											<div class="onShow">百科,问答等页面显示的名字</div>
										</div>
									</td>
								</tr>
								<tr>
									<td align="right">
										<font>*</font>手机：
									</td>
									<td>
										<input name="tbPhone" type="text" value="" id="tbPhone" class="inputk">
									</td>
									<td>
										<div style="width: 350px; margin: 0px; padding: 0px; background: transparent;" id="tbPhoneTip" class="onShow">
											<div class="onShow">请填写真实手机，避免错失商机！</div>
										</div>
									</td>
								</tr>
								<tr>
									<td align="right">
										固定电话：
									</td>
									<td>
										<input name="tbTel" type="text" value="" id="tbTel" class="inputk">
									</td>
									<td>
										<div style="width: 350px; margin: 0px; padding: 0px; background: transparent;" id="tbTelTip" class="onShow">
											<div class="onShow">请填写真实电话，避免错失商机！</div>
										</div>
									</td>
								</tr>
								<tr>
									<td align="right">
										QQ：
									</td>
									<td>
										<input name="tbQQ" type="text" id="tbQQ" class="inputk">
									</td>
									<td>
										<div style="width: 350px; margin: 0px; padding: 0px; background: transparent;" id="tbQQTip" class="onShow">
											<div class="onShow">方便其他用户直接通过QQ与您联系哦！</div>
										</div>
									</td>
								</tr>
								<tr>
									<td align="right">
										电子邮箱：
									</td>
									<td>
										<input name="tbEmail" type="text" value="" id="tbEmail" class="text">
									</td>
									<td>
										<div style="width: 350px; margin: 0px; padding: 0px; background: transparent;" id="tbEmailTip" class="onShow">
											<div class="onShow">通过邮箱可以找回密码、获取最新美酒活动哦</div>
										</div>
									</td>
								</tr>
								<tr>
									<td align="right">
										联系地址：
									</td>
									<td>
										<input name="tbAddress" type="text" id="tbAddress" class="inputk" style="width: 300px">
									</td>
								</tr>
								<tr>
									<td align="right">
										<font>*</font>验证码：
									</td>
									<td>
										<input name="txtValidate" type="text" id="yanzhengma" class="inputk" style="width:120px;"><canvas id="canvas" width="100" height="24"></canvas>
									</td>
									<td>
                            <div id="yanzhengmaTip" style="width: 300px; margin: 0px; padding: 0px; background: transparent;" class="onShow"><div  class="onShow">请填写验证码！</div></div>
                        </td>
								</tr>
								<tr>
									<td>
										&nbsp;
									</td>
									<td>
										<input type="button" name="btnSubmit" value="提   交" id="btnSubmit" class="mimabtn">
									</td>
									<td>
										&nbsp;
									</td>
								</tr>
							</tbody>
						</table>
					</div>
					</tr>
					</tbody>
					</table>
				</div>
			</div>
		</div>
		<script src="../js/cook.js" type="text/javascript" charset="utf-8"></script>
		<script type="text/javascript">
			
			$(function() {
				var show_num = [];
				draw(show_num);
				$("#canvas").on('click', function() {
					draw(show_num);
				})
				//检验是否登录
				var reg1=/\W/;
				var reg2=/[0-9]$/;
				var reg4 = /^1(3|5|6|7|8|9)\d{9}$/;
				var reg5 = /^\w+@\w+(\.\w+)+$/
				var flag1=0;flag2=0;flag3=0;flag4=0;flag5=0;flag6=0;
				if(getCookie("user")){
						var data2=getCookie("user")
						$.getJSON("http://47.102.214.131:8081/jiudaili-1.0/jiudaili/userDetail/getUserInfo.do?userToken="+data2,function(data1){
							// console.log(data1)
							if(data1.code==0){
								// console.log('123')
								location.href="../html/fabusj.html";
							}
							$('#username').text(data1.data.userName);
							$('#tbChenHu').val(data1.data.name);
							$('#tbNickName').val(data1.data.nick);
							$('#tbPhone').val(data1.data.phone)
							$('#tbTel').val(data1.data.tel)
							$('#tbQQ').val(data1.data.qqcard)
							$('#tbEmail').val(data1.data.email)
							$('#tbAddress').val(data1.data.uaddress)
							
							
						})
					}
				$("#tbNickName").change(function() {         
					if(!reg1.test($("#tbNickName").val())) {
						$("#tbNickNameTip div").html("请输入昵称");
						$("#tbNickNameTip div").attr("class","onError")
						  flag1=0;       
					} else {
						flag1=1;
						$("#tbNickNameTip div").html("输入正确");
						$("#tbNickNameTip div").attr("class","onCorrect")
					}      
				});
				$("#tbPhone").change(function() {         
					if(!reg4.test($("#tbPhone").val())) {
						$("#tbPhoneTip div").html("你输入的手机格式不正确");
						$("#tbPhoneTip div").attr("class","onError")
						  flag2=0;       
					} else {
						flag2=1;
						$("#tbPhoneTip div").html("输入正确");
						$("#tbPhoneTip div").attr("class","onCorrect")
					}      
				});
				$("#tbTel").change(function() {         
					if(!reg4.test($("#tbTel").val())) {
						$("#tbTelTip div").html("你输入的电话格式不正确");
						$("#tbTelTip div").attr("class","onError")
						  flag3=0;       
					} else {
						flag3=1;
						$("#tbTelTip div").html("输入正确");
						$("#tbTelTip div").attr("class","onCorrect")
					}      
				});
				$("#tbQQ").change(function() {         
					if(!reg2.test($("#tbQQ").val())) {
						$("#tbQQTip div").html("你输入的qq格式不正确");
						$("#tbQQTip div").attr("class","onError")
						  flag4=0;       
					} else {
						flag4=1;
						$("#tbQQTip div").html("输入正确");
						$("#tbQQTip div").attr("class","onCorrect")
					}      
				});
				$("#tbEmail").change(function() {         
					if(!reg5.test($("#tbEmail").val())) {
						$("#tbEmailTip div").html("你输入的qq邮箱格式不正确");
						$("#tbEmailTip div").attr("class","onError")
						  flag5=0;       
					} else {
						flag5=1;
						$("#tbEmailTip div").html("输入正确");
						$("#tbEmailTip div").attr("class","onCorrect")
					}      
				});
				$("#yanzhengma").change(function() {
					var num = show_num.join(""); 
					var val = $("#yanzhengma").val().toLowerCase();
					if(val==num) {
						$("#yanzhengmaTip div").html("输入正确");
						$("#yanzhengmaTip div").attr("class","onCorrect")
						  flag6=1;       
					} else {
						flag6=0;
						$("#yanzhengmaTip div").html("你输入的验证码不正确");
						$("#yanzhengmaTip div").attr("class","onError")
						draw(show_num);
					}      
				});
				
			
				
				$("#btnSubmit").on('click', function() {
					var user=$("#user").val();
					var pwd=$("#pwd").val();
					var data={"userName":user,"password":pwd}
					
					data=JSON.stringify(data);
//					console.log(data)
//					console.log($("#yanzhengma").val())
					var val = $("#yanzhengma").val().toLowerCase();
					var num = show_num.join("");
					
					if(val == '') {
						alert('请输入验证码！');
					} else if(val == num) {
						$.getJSON("http://47.102.214.131:8081/jiudaili-1.0/jiudaili/userDetail/updateUserDetail.do?email="+$('#tbEmail').val()+"&name="+$('#tbChenHu').val()+"&nick="+$('#tbNickName').val()+"&phone="+$('#tbPhone').val()+"&qqcard="+$('#tbQQ').val()+"&tel="+$('#tbTel').val()+"&uaddress="+$('#tbAddress').val()+"&userToken="+getCookie("user"),function(data1){
							if(data1.code==0){
								location.href="../html/fabusj.html";
							}else{
								$('#username').text(data1.data.userName);
							$('#tbChenHu').val(data1.data.name);
							$('#tbNickName').val(data1.data.nick);
							$('#tbPhone').val(data1.data.phone)
							$('#tbTel').val(data1.data.tel)
							$('#tbQQ').val(data1.data.qqcard)
							$('#tbEmail').val(data1.data.email)
							$('#tbAddress').val(data1.data.uaddress)
							}
							location.reload()
							
							
						}) 
						
					} else {
						alert('验证码错误！请重新输入！');
						$("#yanzhengma").val('');
						 draw(show_num);
					}
				})
			})
		
			//生成并渲染出验证码图形
			function draw(show_num) {
				var canvas_width = $('#canvas').width();
				var canvas_height = $('#canvas').height();
				var canvas = document.getElementById("canvas"); //获取到canvas的对象，演员
				var context = canvas.getContext("2d"); //获取到canvas画图的环境，演员表演的舞台
				canvas.width = canvas_width;
				canvas.height = canvas_height;
				var sCode = "a,b,c,d,e,f,g,h,i,j,k,m,n,p,q,r,s,t,u,v,w,x,y,z,A,B,C,E,F,G,H,J,K,L,M,N,P,Q,R,S,T,W,X,Y,Z,1,2,3,4,5,6,7,8,9,0";
				var aCode = sCode.split(",");
				var aLength = aCode.length; //获取到数组的长度
				for(var i = 0; i < 4; i++) { //这里的for循环可以控制验证码位数（如果想显示6位数，4改成6即可）
					var j = Math.floor(Math.random() * aLength); //获取到随机的索引值
					// var deg = Math.random() * 30 * Math.PI / 180;//产生0~30之间的随机弧度
					var deg = Math.random() - 0.5; //产生一个随机弧度
					var txt = aCode[j]; //得到随机的一个内容
					show_num[i] = txt.toLowerCase();
					var x = 10 + i * 20; //文字在canvas上的x坐标
					var y = 20 + Math.random() * 8; //文字在canvas上的y坐标
					context.font = "bold 23px 微软雅黑";
					context.translate(x, y);
					context.rotate(deg);
					context.fillStyle = randomColor();
					context.fillText(txt, 0, 0);
					context.rotate(-deg);
					context.translate(-x, -y);
				}
				for(var i = 0; i <= 5; i++) { //验证码上显示线条
					context.strokeStyle = randomColor();
					context.beginPath();
					context.moveTo(Math.random() * canvas_width, Math.random() * canvas_height);
					context.lineTo(Math.random() * canvas_width, Math.random() * canvas_height);
					context.stroke();
				}
				for(var i = 0; i <= 30; i++) { //验证码上显示小点
					context.strokeStyle = randomColor();
					context.beginPath();
					var x = Math.random() * canvas_width;
					var y = Math.random() * canvas_height;
					context.moveTo(x, y);
					context.lineTo(x + 1, y + 1);
					context.stroke();
				}
			}
			//得到随机的颜色值
			function randomColor() {
				var r = Math.floor(Math.random() * 256);
				var g = Math.floor(Math.random() * 256);
				var b = Math.floor(Math.random() * 256);
				return "rgb(" + r + "," + g + "," + b + ")";
			}
		</script>
	</body>

</html>